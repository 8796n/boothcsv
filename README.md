# boothcsv
BOOTHの宛名印刷用CSVを使って帳票を作るやつ

> 💡 **初めて使う方へ**: このページでは詳しい使い方を説明しています。すぐに使い始めたい方は[基本的な使い方](#どうやって使うの)からご覧ください。

### おしらせ
* これは便利だーって思っていただいたおやさしい方はデバッグに協力すると思って[NyanticLabs.](https://nyantic.booth.pm/)からなんか買ってください。これを使って帳票印刷して送ります。

## 想定する使用対象者は誰？
[BOOTH](https://booth.pm/)で自家通販をしている人で主に「[あんしんBOOTHパック](https://booth.pm/anshin_booth_pack_guides)」の利用者

## おまえはだれだ？
JavaScriptとかなるべく使いたくないBOOTHで自家通販しているあんしんBOOTHパック利用者の猫グッズ屋のおじさん。  
端的に言えば自分で使う用。

## なんで作ったの？
猫グッズを売るときに手数料も安いし手軽に出品できるし匿名配送も使えるのでpixivさんのやってるBOOTHって便利なんですよ。  
そのBOOTHで自家通販をすると、当然ですが売れたら誰かに何かを送ります。  
発送処理をしていて箱に入れる商品どれ？いくつ？みたいなことがよくあったので誤発送を防止するために作りました。 
  
あんしんBOOTHパックで送るときに誰に送るかが分からないため、外箱に注文番号とか印刷したシールがあると便利だよね？それにネコピットで読み込むQRコードがあればもっと便利だよね？ってことでそれもできるようにしました。  
仕組みで防げる誤発送は無くそう！

## なにができるの？
出荷準備のときにあると便利な帳票と「あんしんBOOTHパック」で出荷のときに便利なQRコードをラベルシールに印刷できます。  
あと、注文明細に画像を追加して印刷することもできるようになりました。全注文共通の画像と注文ごとの個別画像が設定でき、表示のON/OFF切り替えも可能です。  
さらに、カスタムラベル機能により任意の文字列を複数枚印刷することも可能です。

## 動作環境は？
Windows版のChrome 138で動作確認をしています。  
最近のChromeなら動くと思いますが仕様が変わると動かない機能もあるかもしれません。  
スマートフォンのChromeだとラベルシール印刷がズレると思うのでたぶん駄目です。  
JavaScriptでどうにかしてるので**別途サーバーなどは必要ありませんし外部に情報を送ることもありません。**  

## 📋 目次
- [基本的な使い方](#どうやって使うの)
- [ラベルシール印刷](#ラベルシールも印刷したい)
- [画像機能について](#画像機能について)
- [カスタムラベル機能について](#カスタムラベル機能について)
- [デバッグ機能](#デバッグ機能)
- [サンプルで試す](#boothで売れてないけど試したい)  

<img width="1248" height="634" alt="Image" src="https://github.com/user-attachments/assets/819afe49-88db-4f0c-8a48-bea5e66235c1" />
## どうやって使うの？
* [ここ](https://github.com/8796n/boothcsv/archive/master.zip)からzipファイルをダウンロードして展開します。
* boothcsv.html を Chrome から開きます。
* 注文明細に画像を印刷したい場合は、まず「注文明細に画像を表示」にチェックを入れます。
* 全ての注文に同じ画像を表示したい場合は、「注文明細の余白に表示したい画像をここにドロップ or クリックでファイルを選択」のところに画像をドラッグ&ドロップするかクリックしてファイル選択します。
* カスタムラベルを印刷したい場合は、「残りラベルに任意文字列を印刷」にチェックを入れて、印刷したい文字列と枚数を設定します。複数のカスタムラベルを設定したい場合は「ラベル追加」ボタンで項目を追加できます。
* ファイルを選択ボタンを押して[BOOTHの注文一覧](https://manage.booth.pm/orders?state=paid)からダウンロードした宛名印刷用CSVを選択します。
* 支払い日時で並び替えたい場合はチェックボックスにチェックを入れます。BOOTHからダウンロードしたCSVは新しい注文が上に来るので、支払いの古い順に並べ替えたい場合に便利です。
* 実行ボタンを押すと印刷に必要な枚数が表示されます。
* 特定の注文だけ別の画像を表示したい場合は、その注文明細の「この注文専用の画像（グローバル画像より優先されます）」のところに画像をドロップします。個別画像はグローバル画像より優先されるので、設定すればその注文だけ別の画像が表示されます。
* 「注文明細に画像を表示」のチェックを外すと、設定した画像は保持されたまま表示だけを切り替えできます。リアルタイムで反映されるので印刷時の調整に便利です。
* ラベルシールも印刷するときの説明はまたあとで。
* プリンターに用紙をセットして印刷します。
* おしまい。

## ラベルシールも印刷したい
これね、ヤマトの営業所持ち込みであんしんBOOTHパック使うときにはすげえ便利なんですよ。[PUDOステーション](https://booth.pixiv.help/hc/ja/articles/360013148033)に放り込むときにもめっちゃ便利です。慣れると1出荷30秒ぐらいでできます。
* A4 44面 四辺余白付のラベルシールを用意します。例えば[これ](https://amzn.to/2KkRXhE)とか[これ](https://amzn.to/2KpdW7k)</a>
* ラベルシールも印刷するにチェックを入れます。
* 途中まで使ったラベルシールを再使用する場合にはスキップする枚数を入れます。あまり再使用しすぎるとプリンターの中で剥がれたりするかもしれないのでほどほどに。
* さっきと一緒でCSVファイルを選んで実行ボタンを押すと、ラベル用紙の枚数も表示されます。
<img width="857" height="901" alt="image" src="https://github.com/user-attachments/assets/66bd425e-2fc5-4751-b8ef-a5be943aa400" />

* BOOTHの注文詳細で[あんしんBOOTHパックのQRコードを作成](https://booth.pm/anshin_booth_pack_guides/usage)して、表示されたQRコードの画像を右クリックでコピーしてから該当の注文番号のラベルの「Paste QR image here!」を右クリックして貼り付けを選ぶとQRコードが表示されて自動的に匿名配送の受付番号とパスワードが表示されます。自動です。オートマチック！！
<img width="858" height="283" alt="image" src="https://github.com/user-attachments/assets/cb50426f-79a6-4ad2-a34f-362fec1afa2a" />
* なお間違えて貼り付けたときはQRコードをクリックすると再度貼り付けできるようになります。
* 印刷したラベルシールを出荷する箱に貼り付けておけば出荷時にネコピットを箱に貼ったQRコードにかざす→その箱に貼る送り状が印刷されるという流れになるので送り間違いは発生しません。万が一QRコードの読み込みが上手く行かなかった場合でもラベルシールに印刷されている受付番号とパスワードを入力すれば送り状が出力できるので安心です。

## 画像機能について
<img width="821" height="1136" alt="image" src="https://github.com/user-attachments/assets/aac1d2cf-9188-4d55-a967-e11afd870d42" />

注文明細に画像を追加できる機能があります。

### 基本的な使い方
<img width="1193" height="602" alt="image" src="https://github.com/user-attachments/assets/54a20a5d-2833-4042-9de3-abcae53def69" />

1. **画像表示の有効化**: まず「注文明細に画像を表示」にチェックを入れてください。
2. **画像設定**: 以下の2つの方法で画像を設定できます：
   * **グローバル画像**: 全ての注文明細に同じ画像を表示したい場合。「注文明細の余白に表示したい画像をここにドロップ or クリックでファイルを選択」の部分に画像をドロップするか選択します。
   * **個別画像**: 特定の注文だけ別の画像を表示したい場合。実行後に表示される各注文明細の「この注文専用の画像」部分に画像をドロップします。
3. **表示切り替え**: 「注文明細に画像を表示」のチェックを外すと、設定した画像は保持されたまま表示だけをリアルタイムで切り替えできます。印刷時の調整に便利です。

**対応画像形式**: JPEG、PNG、SVG（.jpg、.jpeg、.png、.svg）

個別画像はグローバル画像より優先されます。つまり個別画像を設定した注文はその画像が、設定しなかった注文はグローバル画像が表示されます。

画像は全部localStorageに保存されるので、ページを再読み込みしても残ってます。不要になったらクリアボタンで削除できます：
* **全てのQR画像をクリア**: QRコード関連の画像だけ削除
* **全ての注文画像をクリア**: グローバル画像と全ての個別画像を削除

画像をクリックすると削除されるので、間違えて設定した場合も簡単にリセットできます。印刷時は画像ドロップゾーンは表示されないので邪魔になりません。

## カスタムラベル機能について
<img width="861" height="353" alt="image" src="https://github.com/user-attachments/assets/db49a208-bd67-46be-b4f7-055d52e9a823" />

余った44面シールに商品名や管理用文字列を印刷できる機能です。商品管理や在庫整理の際に便利です。
* **有効化**: 「残りラベルに任意文字列を印刷」のチェックボックスをオンにします。
* **文字列入力**: ラベルに印刷したい文字列を入力します。商品名、品番、管理コードなど任意のテキストが可能です。太字や斜体、フォントサイズの変更もできます。
* **枚数設定**: 印刷したい枚数を指定します。
* **複数ラベル**: 「ラベル追加」ボタンで複数のカスタムラベルを設定できます。
* **削除**: 不要なラベルは「削除」ボタンで削除できます（最低1つは必要）。

**文字列の編集方法**：
<img width="908" height="908" alt="image" src="https://github.com/user-attachments/assets/3bf85481-8876-4b6e-ac8d-159fa715ab71" />

* テキストエリア内で普通に文字を入力
* 改行: Enterキー
* 書式設定: 右クリックでコンテキストメニューを表示
  - 太字、斜体の切り替え
  - フォントサイズの変更（8pt〜24pt）

設定した内容はブラウザに保存されるので、ページを再読み込みしても残ります。

## BOOTHで売れてないけど試したい
* sampleにcsvファイルとQRコードのpngファイルがあるので試せます。
* 参考までに手元にあるpngファイルは直接該当箇所にドラッグアンドドロップすれば貼り付けられます。画像機能も同じようにドラッグ&ドロップで試せます。
* 当然ですが、サンプルのデータはダミーの数字が入っているので出荷では使えません。

## 使ってる仕組み
* 印刷に便利なCSS [Paper CSS](https://github.com/cognitom/paper-css)
* QRコード読んでくれるJavaScript [jsQR](https://github.com/cozmo/jsQR)
* CSVをいい感じに読んでくれるJavaScript [PapaParse](https://github.com/mholt/PapaParse)

## 裏側の見どころ
* こだわりの素JavaScriptでHTML5のtemplateタグを使ってます。最近はquerySelectorのおかげでjQueryなしでも要素の選択が割と簡単にできるようになったみたいです。
* Paper CSS強い。templateと合わせると通常の業務で使う帳票はだいたい表現できるぞ！サーバーでPDF作ってダウンロードさせて印刷とかしなくてもいいし、Chrome上での見た目がいきなり印刷プレビュー風で謎の安心感があります。
* BOOTHからダウンロードするCSVのヘッダが日本語なので、classとかも全力で日本語です。可読性高い！
* localStorageに画像とかQRコードの情報を保存してるので、ブラウザ閉じても設定が残って便利です。でもlocalStorageの容量制限があるので画像をバンバン保存しすぎると容量オーバーになるかもしれません。そうなったらクリアボタンで削除してください。

## デバッグ機能
開発やトラブルシューティング用にデバッグログ機能があります。
* **有効化**: URLに `?debug=1` を付けてアクセス（例: `boothcsv.html?debug=1`）
* **無効化**: 通常通りアクセス（デバッグログは出力されません）

デバッグモードでは、カスタムラベルの追加やQRコード処理などの詳細な動作がコンソールに出力されます。

## 動けばOK主義者
* なんで動いてるかよくわからないところはだいたい潰して理解したつもりです。
* 印刷物に関係ないフォームの部分などは動けばOK主義者なので必要最小限です。見た目にこだわる方はプルリクエスト？とかいうやつをしていただけるといいと思います。

## 文字打つの飽きたので続きはまた今度
